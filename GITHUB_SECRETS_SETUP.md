# GitHub Secrets Configuration Guide

This guide shows you exactly which secrets to add to GitHub for CI/CD deployment.

## ðŸ“ Where to Add Secrets

1. Go to your GitHub repository
2. Click **Settings** â†’ **Secrets and variables** â†’ **Actions**
3. Click **New repository secret**
4. Add each secret below

---

## ðŸ” Required Secrets

### 1. Azure Credentials

**Secret Name**: `AZURE_CREDENTIALS`

**Where to get it**: Run the setup script or manually:
```bash
SUBSCRIPTION_ID=$(az account show --query id -o tsv)
az ad sp create-for-rbac \
  --name "aura-audit-ai-cicd" \
  --role contributor \
  --scopes /subscriptions/$SUBSCRIPTION_ID \
  --sdk-auth
```

**Value format**: Entire JSON output
```json
{
  "clientId": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
  "clientSecret": "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
  "subscriptionId": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
  "tenantId": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
  "activeDirectoryEndpointUrl": "https://login.microsoftonline.com",
  "resourceManagerEndpointUrl": "https://management.azure.com/",
  "activeDirectoryGraphResourceId": "https://graph.windows.net/",
  "sqlManagementEndpointUrl": "https://management.core.windows.net:8443/",
  "galleryEndpointUrl": "https://gallery.azure.com/",
  "managementEndpointUrl": "https://management.core.windows.net/"
}
```

---

### 2. Terraform Backend Storage

**Secret Name**: `TF_BACKEND_STORAGE_ACCOUNT`

**Where to get it**: After running setup script, check `terraform-backend-config.txt`
```bash
cat terraform-backend-config.txt | grep "Storage Account:"
```

**Value example**: `auratfstate1698765432`

---

**Secret Name**: `TF_BACKEND_ACCESS_KEY`

**Where to get it**: After running setup script, check `terraform-backend-config.txt`
```bash
cat terraform-backend-config.txt | grep "Access Key:"
```

**Value example**: Long base64 string like `xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx==`

---

### 3. OpenAI API Key

**Secret Name**: `OPENAI_API_KEY`

**Where to get it**: https://platform.openai.com/api-keys

**Value format**: `sk-proj-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`

**Cost estimate**: ~$50-200/month depending on usage

---

### 4. Security Secrets

These are generated by the setup script in `azure-secrets.env`

**Secret Name**: `JWT_SECRET`

**Where to get it**:
```bash
cat azure-secrets.env | grep JWT_SECRET
# Or generate: openssl rand -hex 32
```

**Value example**: `a1b2c3d4e5f6...` (64 hex characters)

---

**Secret Name**: `ENCRYPTION_KEY`

**Where to get it**:
```bash
cat azure-secrets.env | grep ENCRYPTION_KEY
# Or generate: openssl rand -hex 32
```

**Value example**: `x1y2z3...` (64 hex characters)

---

**Secret Name**: `MASTER_KEY`

**Where to get it**:
```bash
cat azure-secrets.env | grep MASTER_KEY
# Or generate: openssl rand -hex 32
```

**Value example**: `9a8b7c...` (64 hex characters)

---

### 5. Database Credentials

**Secret Name**: `POSTGRES_PASSWORD`

**Where to get it**:
```bash
cat azure-secrets.env | grep POSTGRES_PASSWORD
# Or generate: openssl rand -base64 24 | tr -d "=+/" | cut -c1-20
```

**Value example**: `aBcDeFgHiJkLmNoPqRsT`

**Note**: Must be at least 8 characters, contain uppercase, lowercase, and numbers

---

## ðŸ”§ Optional Secrets (for integrations)

Add these only if you're using the respective services:

### Accounting Integrations

| Secret Name | Get From | When Needed |
|-------------|----------|-------------|
| `QBO_CLIENT_ID` | https://developer.intuit.com | QuickBooks integration |
| `QBO_CLIENT_SECRET` | https://developer.intuit.com | QuickBooks integration |
| `XERO_CLIENT_ID` | https://developer.xero.com | Xero integration |
| `XERO_CLIENT_SECRET` | https://developer.xero.com | Xero integration |
| `NETSUITE_ACCOUNT_ID` | NetSuite account | NetSuite integration |
| `NETSUITE_CONSUMER_KEY` | NetSuite account | NetSuite integration |
| `NETSUITE_CONSUMER_SECRET` | NetSuite account | NetSuite integration |

### Payment & E-Signature

| Secret Name | Get From | When Needed |
|-------------|----------|-------------|
| `STRIPE_API_KEY` | https://dashboard.stripe.com/apikeys | Payment processing |
| `STRIPE_WEBHOOK_SECRET` | Stripe webhooks page | Payment webhooks |
| `DOCUSIGN_INTEGRATION_KEY` | https://developers.docusign.com | E-signatures |
| `DOCUSIGN_SECRET_KEY` | https://developers.docusign.com | E-signatures |

### Email & Monitoring

| Secret Name | Get From | When Needed |
|-------------|----------|-------------|
| `SENDGRID_API_KEY` | https://app.sendgrid.com | Email notifications |
| `SENTRY_DSN` | https://sentry.io | Error tracking |
| `PLAID_CLIENT_ID` | https://dashboard.plaid.com | Bank verification |
| `PLAID_SECRET` | https://dashboard.plaid.com | Bank verification |

### Docker Hub (Optional - for faster builds)

| Secret Name | Get From | When Needed |
|-------------|----------|-------------|
| `DOCKER_HUB_USERNAME` | Docker Hub account | Image caching |
| `DOCKER_HUB_TOKEN` | Docker Hub â†’ Account Settings â†’ Security | Image caching |

---

## âœ… Quick Checklist

Copy this checklist and mark off as you add secrets:

```
Required Secrets (Must have these):
[ ] AZURE_CREDENTIALS
[ ] TF_BACKEND_STORAGE_ACCOUNT
[ ] TF_BACKEND_ACCESS_KEY
[ ] OPENAI_API_KEY
[ ] JWT_SECRET
[ ] ENCRYPTION_KEY
[ ] MASTER_KEY
[ ] POSTGRES_PASSWORD

Optional Secrets (Add as needed):
[ ] QBO_CLIENT_ID
[ ] QBO_CLIENT_SECRET
[ ] XERO_CLIENT_ID
[ ] XERO_CLIENT_SECRET
[ ] NETSUITE_ACCOUNT_ID
[ ] STRIPE_API_KEY
[ ] STRIPE_WEBHOOK_SECRET
[ ] DOCUSIGN_INTEGRATION_KEY
[ ] SENDGRID_API_KEY
[ ] DOCKER_HUB_USERNAME
[ ] DOCKER_HUB_TOKEN
```

---

## ðŸ§ª Testing Secrets

After adding secrets, verify they're accessible:

1. Go to **Actions** tab in GitHub
2. Click on **Deploy to Azure** workflow
3. Click **Run workflow**
4. Select branch: `claude/setup-azure-environment-011CUxjAxZVDTgq1Lvbs6vDV`
5. Run the workflow

If secrets are configured correctly, the workflow should:
- âœ… Authenticate to Azure
- âœ… Initialize Terraform
- âœ… Deploy infrastructure

---

## ðŸ”’ Security Best Practices

### DO:
- âœ… Rotate secrets every 90 days
- âœ… Use different secrets for dev/staging/prod environments
- âœ… Store backup of secrets in a password manager (1Password, LastPass, etc.)
- âœ… Limit who has access to GitHub secrets
- âœ… Use Azure Key Vault for production secrets (more secure)
- âœ… Enable audit logging for secret access

### DON'T:
- âŒ Commit secrets to git (even in private repos)
- âŒ Share secrets via email, Slack, or other messaging
- âŒ Use the same secrets across multiple environments
- âŒ Store secrets in plain text files on your computer
- âŒ Screenshot or copy secrets to clipboard managers

---

## ðŸ”„ Secret Rotation

Schedule to rotate these secrets every 90 days:

### Auto-expiring Secrets:
- `AZURE_CREDENTIALS` (service principal)
- API keys for third-party services

### Rotation Process:

**For Service Principal:**
```bash
# Reset credentials
az ad sp credential reset --name aura-audit-ai-cicd --sdk-auth > new-azure-credentials.json

# Update GitHub secret with new JSON
```

**For JWT/Encryption Keys:**
```bash
# Generate new keys
NEW_JWT_SECRET=$(openssl rand -hex 32)
NEW_ENCRYPTION_KEY=$(openssl rand -hex 32)

# Update .env.production and GitHub secrets
# Deploy with dual-key support (old + new)
# Wait 24 hours for all sessions to migrate
# Remove old keys
```

**For Database Password:**
```bash
# Update in Azure Portal or via Azure CLI
az postgres flexible-server update \
  --resource-group aura-audit-ai-prod-rg \
  --name aura-audit-ai-prod-postgres \
  --admin-password "NEW_PASSWORD"

# Update GitHub secret and .env.production
# Restart application pods
```

---

## ðŸ“± Accessing Secrets in GitHub Actions

In your workflow files (`.github/workflows/*.yml`), access secrets like this:

```yaml
- name: Azure Login
  uses: azure/login@v1
  with:
    creds: ${{ secrets.AZURE_CREDENTIALS }}

- name: Deploy with Terraform
  env:
    TF_VAR_postgres_password: ${{ secrets.POSTGRES_PASSWORD }}
    TF_VAR_openai_api_key: ${{ secrets.OPENAI_API_KEY }}
  run: |
    terraform apply -auto-approve
```

---

## ðŸ†˜ Troubleshooting

### Issue: "Secret not found" error in workflow

**Solution**:
1. Verify secret name matches exactly (case-sensitive)
2. Check you added it to **repository secrets** (not environment secrets)
3. Re-add the secret

### Issue: Azure authentication fails

**Solution**:
1. Verify `AZURE_CREDENTIALS` is valid JSON
2. Check service principal hasn't expired
3. Verify service principal has Contributor role:
   ```bash
   az role assignment list --assignee <client-id> --output table
   ```

### Issue: Terraform backend access denied

**Solution**:
1. Verify `TF_BACKEND_ACCESS_KEY` is correct
2. Check storage account still exists:
   ```bash
   az storage account show --name <storage-account-name>
   ```

---

## ðŸ“š Additional Resources

- [GitHub Encrypted Secrets Documentation](https://docs.github.com/en/actions/security-guides/encrypted-secrets)
- [Azure Service Principal Best Practices](https://learn.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal)
- [Azure Key Vault Integration](https://github.com/Azure/get-keyvault-secrets)
- [Secret Scanning](https://docs.github.com/en/code-security/secret-scanning/about-secret-scanning)

---

## âœ… Verification

After adding all required secrets, run this verification:

```bash
# Clone your repo in a new location
git clone https://github.com/YOUR_USERNAME/Data-Norm-2.git verify-secrets
cd verify-secrets

# Check GitHub Actions
gh secret list

# You should see all required secrets listed
```

Expected output:
```
AZURE_CREDENTIALS
ENCRYPTION_KEY
JWT_SECRET
MASTER_KEY
OPENAI_API_KEY
POSTGRES_PASSWORD
TF_BACKEND_ACCESS_KEY
TF_BACKEND_STORAGE_ACCOUNT
```

---

**Need Help?**

If you're stuck:
1. Double-check secret names (exact match, case-sensitive)
2. Verify secret values don't have extra spaces or newlines
3. Test individual secrets in a simple workflow
4. Check GitHub Actions logs for specific error messages

Good luck! ðŸš€
