# SecretProviderClass for Azure Key Vault integration
apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: aura-kv-secrets
  namespace: aura-audit-ai
spec:
  provider: azure
  parameters:
    usePodIdentity: "false"
    useVMManagedIdentity: "true"
    userAssignedIdentityID: "" # Will be populated by Terraform
    keyvaultName: "" # Will be populated by Terraform (e.g., aura-audit-ai-prod-kv)
    cloudName: "AzurePublicCloud"
    objects:  |
      array:
        - |
          objectName: postgres-admin-password
          objectType: secret
          objectVersion: ""
        - |
          objectName: redis-primary-key
          objectType: secret
          objectVersion: ""
        - |
          objectName: storage-connection-string
          objectType: secret
          objectVersion: ""
        - |
          objectName: jwt-secret
          objectType: secret
          objectVersion: ""
        - |
          objectName: airflow-fernet-key
          objectType: secret
          objectVersion: ""
        - |
          objectName: appinsights-instrumentation-key
          objectType: secret
          objectVersion: ""
    tenantId: "" # Will be populated by Terraform
  secretObjects:
  - data:
    - key: postgres-password
      objectName: postgres-admin-password
    - key: redis-key
      objectName: redis-primary-key
    - key: storage-connection-string
      objectName: storage-connection-string
    - key: jwt-secret
      objectName: jwt-secret
    - key: airflow-fernet-key
      objectName: airflow-fernet-key
    - key: appinsights-key
      objectName: appinsights-instrumentation-key
    secretName: aura-secrets
    type: Opaque
