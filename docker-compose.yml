version: '3.8'

services:
  # ========================================
  # Infrastructure Services
  # ========================================

  db:
    image: pgvector/pgvector:pg15
    container_name: atlas-db
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-atlas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-atlas_secret}
      POSTGRES_DB: ${POSTGRES_DB:-atlas}
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./db/migrations:/docker-entrypoint-initdb.d:ro
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U atlas"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - atlas-network

  redis:
    image: redis:7-alpine
    container_name: atlas-redis
    ports:
      - "6379:6379"
    command: redis-server --appendonly yes
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 3s
      retries: 5
    networks:
      - atlas-network

  minio:
    image: minio/minio:latest
    container_name: atlas-minio
    environment:
      MINIO_ROOT_USER: ${MINIO_ROOT_USER:-minio}
      MINIO_ROOT_PASSWORD: ${MINIO_ROOT_PASSWORD:-minio123}
    ports:
      - "9000:9000"
      - "9001:9001"
    command: server /data --console-address ":9001"
    volumes:
      - minio_data:/data
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]
      interval: 30s
      timeout: 10s
      retries: 3
    networks:
      - atlas-network

  # ========================================
  # API Gateway
  # ========================================

  api-gateway:
    build:
      context: ./services/gateway
      dockerfile: Dockerfile
    container_name: atlas-api-gateway
    environment:
      - REDIS_URL=redis://redis:6379/0
    ports:
      - "8000:8000"
    depends_on:
      redis:
        condition: service_healthy
    volumes:
      - ./services/gateway:/app:ro
    networks:
      - atlas-network
    restart: unless-stopped

  # ========================================
  # Backend Services (FastAPI)
  # ========================================

  api-ingestion:
    build:
      context: ./services/ingestion
      dockerfile: Dockerfile
    container_name: atlas-api-ingestion
    environment:
      - DATABASE_URL=${DATABASE_URL:-postgresql://atlas:atlas_secret@db:5432/atlas}
      - REDIS_URL=${REDIS_URL:-redis://redis:6379/0}
      - S3_ENDPOINT=${S3_ENDPOINT:-http://minio:9000}
      - S3_ACCESS_KEY=${S3_ACCESS_KEY:-minio}
      - S3_SECRET_KEY=${S3_SECRET_KEY:-minio123}
      - EDGAR_BASE_URL=${EDGAR_BASE_URL:-https://data.sec.gov}
      - EDGAR_USER_AGENT=${EDGAR_USER_AGENT:-Aura Audit AI contact@aura-audit.ai}
    ports:
      - "8001:8000"
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
      minio:
        condition: service_healthy
    volumes:
      - ./services/ingestion:/app:ro
    networks:
      - atlas-network

  api-normalize:
    build:
      context: ./services/normalize
      dockerfile: Dockerfile
    container_name: atlas-api-normalize
    environment:
      - DATABASE_URL=${DATABASE_URL:-postgresql://atlas:atlas_secret@db:5432/atlas}
      - REDIS_URL=${REDIS_URL:-redis://redis:6379/0}
    ports:
      - "8002:8000"
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ./services/normalize:/app:ro
    networks:
      - atlas-network

  api-analytics:
    build:
      context: ./services/analytics
      dockerfile: Dockerfile
    container_name: atlas-api-analytics
    environment:
      - DATABASE_URL=${DATABASE_URL:-postgresql://atlas:atlas_secret@db:5432/atlas}
      - REDIS_URL=${REDIS_URL:-redis://redis:6379/0}
      - MLFLOW_TRACKING_URI=${MLFLOW_TRACKING_URI:-http://mlflow:5000}
    ports:
      - "8003:8000"
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ./services/analytics:/app:ro
    networks:
      - atlas-network

  api-llm:
    build:
      context: ./services/llm
      dockerfile: Dockerfile
    container_name: atlas-api-llm
    environment:
      - DATABASE_URL=${DATABASE_URL:-postgresql://atlas:atlas_secret@db:5432/atlas}
      - REDIS_URL=${REDIS_URL:-redis://redis:6379/0}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-sk-placeholder}
      - OPENAI_CHAT_MODEL=${OPENAI_CHAT_MODEL:-gpt-4-turbo-2024-04-09}
      - OPENAI_EMBEDDING_MODEL=${OPENAI_EMBEDDING_MODEL:-text-embedding-3-large}
      - MLFLOW_TRACKING_URI=${MLFLOW_TRACKING_URI:-http://mlflow:5000}
    ports:
      - "8004:8000"
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ./services/llm:/app:ro
    networks:
      - atlas-network

  api-engagement:
    build:
      context: ./services/engagement
      dockerfile: Dockerfile
    container_name: atlas-api-engagement
    environment:
      - DATABASE_URL=${DATABASE_URL:-postgresql://atlas:atlas_secret@db:5432/atlas}
      - REDIS_URL=${REDIS_URL:-redis://redis:6379/0}
      - S3_ENDPOINT=${S3_ENDPOINT:-http://minio:9000}
      - S3_ACCESS_KEY=${S3_ACCESS_KEY:-minio}
      - S3_SECRET_KEY=${S3_SECRET_KEY:-minio123}
    ports:
      - "8005:8000"
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
      minio:
        condition: service_healthy
    volumes:
      - ./services/engagement:/app:ro
    networks:
      - atlas-network

  api-disclosures:
    build:
      context: ./services/disclosures
      dockerfile: Dockerfile
    container_name: atlas-api-disclosures
    environment:
      - DATABASE_URL=${DATABASE_URL:-postgresql://atlas:atlas_secret@db:5432/atlas}
      - REDIS_URL=${REDIS_URL:-redis://redis:6379/0}
    ports:
      - "8006:8000"
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ./services/disclosures:/app:ro
    networks:
      - atlas-network

  api-reg-ab-audit:
    build:
      context: ./services/reg-ab-audit
      dockerfile: Dockerfile
    container_name: atlas-api-reg-ab-audit
    environment:
      - DATABASE_URL=${DATABASE_URL:-postgresql://atlas:atlas_secret@db:5432/atlas}
      - REDIS_URL=${REDIS_URL:-redis://redis:6379/0}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-sk-placeholder}
      - AI_MODEL_VERSION=${AI_MODEL_VERSION:-gpt-4-turbo}
      - STORAGE_ENDPOINT=${S3_ENDPOINT:-http://minio:9000}
      - STORAGE_ACCESS_KEY=${S3_ACCESS_KEY:-minio}
      - STORAGE_SECRET_KEY=${S3_SECRET_KEY:-minio123}
      - STORAGE_BUCKET=${STORAGE_BUCKET:-reg-ab-audit}
      - CORS_ORIGINS=${CORS_ORIGINS:-http://localhost:3000,http://localhost:3001,http://localhost:5173}
    ports:
      - "8011:8000"
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
      minio:
        condition: service_healthy
    volumes:
      - ./services/reg-ab-audit:/app:ro
    networks:
      - atlas-network

  api-reporting:
    build:
      context: ./services/reporting
      dockerfile: Dockerfile
    container_name: atlas-api-reporting
    environment:
      - DATABASE_URL=${DATABASE_URL:-postgresql://atlas:atlas_secret@db:5432/atlas}
      - REDIS_URL=${REDIS_URL:-redis://redis:6379/0}
      - S3_ENDPOINT=${S3_ENDPOINT:-http://minio:9000}
      - S3_ACCESS_KEY=${S3_ACCESS_KEY:-minio}
      - S3_SECRET_KEY=${S3_SECRET_KEY:-minio123}
      - S3_WORM_BUCKET=${S3_WORM_BUCKET:-atlas-worm}
    ports:
      - "8007:8000"
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
      minio:
        condition: service_healthy
    volumes:
      - ./services/reporting:/app:ro
    networks:
      - atlas-network

  api-qc:
    build:
      context: ./services/qc
      dockerfile: Dockerfile
    container_name: atlas-api-qc
    environment:
      - DATABASE_URL=${DATABASE_URL:-postgresql://atlas:atlas_secret@db:5432/atlas}
      - REDIS_URL=${REDIS_URL:-redis://redis:6379/0}
    ports:
      - "8008:8000"
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ./services/qc:/app:ro
    networks:
      - atlas-network

  api-identity:
    build:
      context: ./services/identity
      dockerfile: Dockerfile
    container_name: atlas-api-identity
    environment:
      - DATABASE_URL=${DATABASE_URL:-postgresql://atlas:atlas_secret@db:5432/atlas}
      - REDIS_URL=${REDIS_URL:-redis://redis:6379/0}
      - JWT_SECRET=${JWT_SECRET:-dev-secret-change-in-production}
      - JWT_ALGORITHM=${JWT_ALGORITHM:-HS256}
      - JWT_EXPIRATION_MINUTES=${JWT_EXPIRATION_MINUTES:-480}
      - OIDC_ENABLED=${OIDC_ENABLED:-false}
    ports:
      - "8009:8000"
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ./services/identity:/app:ro
    networks:
      - atlas-network

  api-connectors:
    build:
      context: ./services/connectors
      dockerfile: Dockerfile
    container_name: atlas-api-connectors
    environment:
      - DATABASE_URL=${DATABASE_URL:-postgresql://atlas:atlas_secret@db:5432/atlas}
      - REDIS_URL=${REDIS_URL:-redis://redis:6379/0}
      - QBO_CLIENT_ID=${QBO_CLIENT_ID:-placeholder}
      - QBO_CLIENT_SECRET=${QBO_CLIENT_SECRET:-placeholder}
    ports:
      - "8010:8000"
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ./services/connectors:/app:ro
    networks:
      - atlas-network

  api-audit-planning:
    build:
      context: ./services/audit-planning
      dockerfile: Dockerfile
    container_name: atlas-api-audit-planning
    environment:
      - DATABASE_URL=${DATABASE_URL:-postgresql://atlas:atlas_secret@db:5432/atlas}
      - REDIS_URL=${REDIS_URL:-redis://redis:6379/0}
      - IDENTITY_SERVICE_URL=${IDENTITY_SERVICE_URL:-http://api-identity:8000}
    ports:
      - "8012:8000"
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ./services/audit-planning:/app:ro
    networks:
      - atlas-network

  api-accounting-integrations:
    build:
      context: ./services/accounting-integrations
      dockerfile: Dockerfile
    container_name: atlas-api-accounting-integrations
    environment:
      - DATABASE_URL=${DATABASE_URL:-postgresql://atlas:atlas_secret@db:5432/atlas}
      - REDIS_URL=${REDIS_URL:-redis://redis:6379/0}
      - QBO_CLIENT_ID=${QBO_CLIENT_ID:-placeholder}
      - QBO_CLIENT_SECRET=${QBO_CLIENT_SECRET:-placeholder}
      - XERO_CLIENT_ID=${XERO_CLIENT_ID:-placeholder}
      - XERO_CLIENT_SECRET=${XERO_CLIENT_SECRET:-placeholder}
      - NETSUITE_ACCOUNT_ID=${NETSUITE_ACCOUNT_ID:-placeholder}
    ports:
      - "8013:8000"
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ./services/accounting-integrations:/app:ro
    networks:
      - atlas-network

  api-data-anonymization:
    build:
      context: ./services/data-anonymization
      dockerfile: Dockerfile
    container_name: atlas-api-data-anonymization
    environment:
      - DATABASE_URL=${DATABASE_URL:-postgresql://atlas:atlas_secret@db:5432/atlas}
      - REDIS_URL=${REDIS_URL:-redis://redis:6379/0}
      - ENCRYPTION_KEY=${ENCRYPTION_KEY:-dev-encryption-key-32-characters}
    ports:
      - "8014:8000"
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ./services/data-anonymization:/app:ro
    networks:
      - atlas-network

  api-financial-analysis:
    build:
      context: ./services/financial-analysis
      dockerfile: Dockerfile
    container_name: atlas-api-financial-analysis
    environment:
      - DATABASE_URL=${DATABASE_URL:-postgresql://atlas:atlas_secret@db:5432/atlas}
      - REDIS_URL=${REDIS_URL:-redis://redis:6379/0}
      - STRIPE_API_KEY=${STRIPE_API_KEY:-sk_test_placeholder}
      - STRIPE_WEBHOOK_SECRET=${STRIPE_WEBHOOK_SECRET:-whsec_placeholder}
    ports:
      - "8015:8000"
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ./services/financial-analysis:/app:ro
    networks:
      - atlas-network

  api-fraud-detection:
    build:
      context: ./services/fraud-detection
      dockerfile: Dockerfile
    container_name: atlas-api-fraud-detection
    environment:
      - DATABASE_URL=${DATABASE_URL:-postgresql://atlas:atlas_secret@db:5432/atlas}
      - REDIS_URL=${REDIS_URL:-redis://redis:6379/0}
      - MLFLOW_TRACKING_URI=${MLFLOW_TRACKING_URI:-http://mlflow:5000}
      - PLAID_CLIENT_ID=${PLAID_CLIENT_ID:-placeholder}
      - PLAID_SECRET=${PLAID_SECRET:-placeholder}
    ports:
      - "8016:8000"
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ./services/fraud-detection:/app:ro
    networks:
      - atlas-network

  api-related-party:
    build:
      context: ./services/related-party
      dockerfile: Dockerfile
    container_name: atlas-api-related-party
    environment:
      - DATABASE_URL=${DATABASE_URL:-postgresql://atlas:atlas_secret@db:5432/atlas}
      - REDIS_URL=${REDIS_URL:-redis://redis:6379/0}
    ports:
      - "8017:8000"
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ./services/related-party:/app:ro
    networks:
      - atlas-network

  api-sampling:
    build:
      context: ./services/sampling
      dockerfile: Dockerfile
    container_name: atlas-api-sampling
    environment:
      - DATABASE_URL=${DATABASE_URL:-postgresql://atlas:atlas_secret@db:5432/atlas}
      - REDIS_URL=${REDIS_URL:-redis://redis:6379/0}
    ports:
      - "8018:8000"
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ./services/sampling:/app:ro
    networks:
      - atlas-network

  api-security:
    build:
      context: ./services/security
      dockerfile: Dockerfile
    container_name: atlas-api-security
    environment:
      - DATABASE_URL=${DATABASE_URL:-postgresql://atlas:atlas_secret@db:5432/atlas}
      - REDIS_URL=${REDIS_URL:-redis://redis:6379/0}
      - MASTER_KEY=${MASTER_KEY:-dev-master-key-change-in-production}
      - KEY_ROTATION_DAYS=${KEY_ROTATION_DAYS:-90}
      - S3_ENDPOINT=${S3_ENDPOINT:-http://minio:9000}
      - S3_ACCESS_KEY=${S3_ACCESS_KEY:-minio}
      - S3_SECRET_KEY=${S3_SECRET_KEY:-minio123}
    ports:
      - "8019:8000"
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
      minio:
        condition: service_healthy
    volumes:
      - ./services/security:/app:ro
    networks:
      - atlas-network

  api-subsequent-events:
    build:
      context: ./services/subsequent-events
      dockerfile: Dockerfile
    container_name: atlas-api-subsequent-events
    environment:
      - DATABASE_URL=${DATABASE_URL:-postgresql://atlas:atlas_secret@db:5432/atlas}
      - REDIS_URL=${REDIS_URL:-redis://redis:6379/0}
    ports:
      - "8020:8000"
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ./services/subsequent-events:/app:ro
    networks:
      - atlas-network

  api-substantive-testing:
    build:
      context: ./services/substantive-testing
      dockerfile: Dockerfile
    container_name: atlas-api-substantive-testing
    environment:
      - DATABASE_URL=${DATABASE_URL:-postgresql://atlas:atlas_secret@db:5432/atlas}
      - REDIS_URL=${REDIS_URL:-redis://redis:6379/0}
    ports:
      - "8021:8000"
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ./services/substantive-testing:/app:ro
    networks:
      - atlas-network

  api-training-data:
    build:
      context: ./services/training-data
      dockerfile: Dockerfile
    container_name: atlas-api-training-data
    environment:
      - DATABASE_URL=${DATABASE_URL:-postgresql://atlas:atlas_secret@db:5432/atlas}
      - REDIS_URL=${REDIS_URL:-redis://redis:6379/0}
      - S3_ENDPOINT=${S3_ENDPOINT:-http://minio:9000}
      - S3_ACCESS_KEY=${S3_ACCESS_KEY:-minio}
      - S3_SECRET_KEY=${S3_SECRET_KEY:-minio123}
      - MLFLOW_TRACKING_URI=${MLFLOW_TRACKING_URI:-http://mlflow:5000}
    ports:
      - "8022:8000"
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
      minio:
        condition: service_healthy
    volumes:
      - ./services/training-data:/app:ro
    networks:
      - atlas-network

  api-eo-insurance-portal:
    build:
      context: ./services/eo-insurance-portal
      dockerfile: Dockerfile
    container_name: atlas-api-eo-insurance-portal
    environment:
      - DATABASE_URL=${DATABASE_URL:-postgresql://atlas:atlas_secret@db:5432/atlas}
      - REDIS_URL=${REDIS_URL:-redis://redis:6379/0}
    ports:
      - "8023:8000"
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ./services/eo-insurance-portal:/app:ro
    networks:
      - atlas-network

  api-estimates-evaluation:
    build:
      context: ./services/estimates-evaluation
      dockerfile: Dockerfile
    container_name: atlas-api-estimates-evaluation
    environment:
      - DATABASE_URL=${DATABASE_URL:-postgresql://atlas:atlas_secret@db:5432/atlas}
      - REDIS_URL=${REDIS_URL:-redis://redis:6379/0}
    ports:
      - "8024:8000"
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ./services/estimates-evaluation:/app:ro
    networks:
      - atlas-network

  # ========================================
  # Orchestration
  # ========================================

  airflow-init:
    image: apache/airflow:2.9.0-python3.11
    container_name: atlas-airflow-init
    environment:
      - AIRFLOW__CORE__EXECUTOR=${AIRFLOW__CORE__EXECUTOR:-LocalExecutor}
      - AIRFLOW__CORE__SQL_ALCHEMY_CONN=postgresql://${POSTGRES_USER:-atlas}:${POSTGRES_PASSWORD:-atlas_secret}@db:5432/airflow
      - AIRFLOW__CORE__FERNET_KEY=${AIRFLOW__CORE__FERNET_KEY:-UKM1qx8EQ9rJlPZo5YN5z0W2fN3h-HJTYbB_Qr2c7kM=}
      - AIRFLOW__CORE__LOAD_EXAMPLES=false
      - _AIRFLOW_DB_MIGRATE=true
      - _AIRFLOW_WWW_USER_CREATE=true
      - _AIRFLOW_WWW_USER_USERNAME=${AIRFLOW_USER:-admin}
      - _AIRFLOW_WWW_USER_PASSWORD=${AIRFLOW_PASSWORD:-admin}
    depends_on:
      db:
        condition: service_healthy
    command: version
    networks:
      - atlas-network

  airflow-webserver:
    image: apache/airflow:2.9.0-python3.11
    container_name: atlas-airflow-webserver
    environment:
      - AIRFLOW__CORE__EXECUTOR=${AIRFLOW__CORE__EXECUTOR:-LocalExecutor}
      - AIRFLOW__CORE__SQL_ALCHEMY_CONN=postgresql://${POSTGRES_USER:-atlas}:${POSTGRES_PASSWORD:-atlas_secret}@db:5432/airflow
      - AIRFLOW__CORE__FERNET_KEY=${AIRFLOW__CORE__FERNET_KEY:-UKM1qx8EQ9rJlPZo5YN5z0W2fN3h-HJTYbB_Qr2c7kM=}
      - AIRFLOW__CORE__LOAD_EXAMPLES=false
      - AIRFLOW__WEBSERVER__SECRET_KEY=${AIRFLOW__WEBSERVER__SECRET_KEY:-airflow_secret_key}
    ports:
      - "8080:8080"
    depends_on:
      - airflow-init
      - db
      - redis
    volumes:
      - ./services/disclosures/web/orchestration/dags:/opt/airflow/dags:ro
      - airflow_logs:/opt/airflow/logs
    command: webserver
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    networks:
      - atlas-network

  airflow-scheduler:
    image: apache/airflow:2.9.0-python3.11
    container_name: atlas-airflow-scheduler
    environment:
      - AIRFLOW__CORE__EXECUTOR=${AIRFLOW__CORE__EXECUTOR:-LocalExecutor}
      - AIRFLOW__CORE__SQL_ALCHEMY_CONN=postgresql://${POSTGRES_USER:-atlas}:${POSTGRES_PASSWORD:-atlas_secret}@db:5432/airflow
      - AIRFLOW__CORE__FERNET_KEY=${AIRFLOW__CORE__FERNET_KEY:-UKM1qx8EQ9rJlPZo5YN5z0W2fN3h-HJTYbB_Qr2c7kM=}
      - AIRFLOW__CORE__LOAD_EXAMPLES=false
    depends_on:
      - airflow-init
      - db
      - redis
    volumes:
      - ./services/disclosures/web/orchestration/dags:/opt/airflow/dags:ro
      - airflow_logs:/opt/airflow/logs
    command: scheduler
    networks:
      - atlas-network

  # ========================================
  # Frontend
  # ========================================

  web:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: atlas-web
    ports:
      - "5173:5173"
    environment:
      - NEXT_PUBLIC_API_URL=${NEXT_PUBLIC_API_URL:-http://localhost:8000}
    volumes:
      - ./frontend:/app:ro
      - /app/node_modules
    networks:
      - atlas-network

  # ========================================
  # Observability (optional)
  # ========================================

  # jaeger:
  #   image: jaegertracing/all-in-one:latest
  #   container_name: atlas-jaeger
  #   ports:
  #     - "16686:16686"  # UI
  #     - "4318:4318"    # OTLP HTTP
  #   networks:
  #     - atlas-network

  # mlflow:
  #   image: ghcr.io/mlflow/mlflow:latest
  #   container_name: atlas-mlflow
  #   ports:
  #     - "5000:5000"
  #   command: mlflow server --host 0.0.0.0 --backend-store-uri postgresql://atlas:atlas_secret@db:5432/mlflow --default-artifact-root s3://mlflow-artifacts
  #   depends_on:
  #     - db
  #     - minio
  #   networks:
  #     - atlas-network

networks:
  atlas-network:
    driver: bridge

volumes:
  postgres_data:
  redis_data:
  minio_data:
  airflow_logs:
